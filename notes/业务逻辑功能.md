---
tags: [HappyWriting]
title: 业务逻辑功能
created: '2020-05-25T06:16:13.210Z'
modified: '2020-05-26T11:02:52.608Z'
---

# 业务逻辑功能
## 小程序端

### APP 全局
#### 判断云开发可用状态
若不可用，提示？
#### 保存用户信息到全局

### 主页页面
#### 获取用户 openid
* 获取用户的 openid，用于判断用户是否存在；
* 通过调用云函数，在回调中得到用户 openid；
#### 判断用户是否存在
* 查询用户表 _openid 字段值为用户 openid 的用户是否存在；
* 不存在则初始化用户；
* 保存用户信息到全局；
#### 初始化用户
* 初始化用户信息；
```JavaScript
{
  _id: [自动生成],
  _openid: [用户openid],
  info: {},
  nickname: null,
  tel: null,
  course: {},
  create_date: [创建时间]
}
```
* 保存用户信息到全局；
#### 获取作业广场数据
* 查询作业表所有数据；
#### 获取推荐课程轮播数据
* 查询课程表 recommend 字段值为 true 的数据，得到字段为 _id、course_image 的对象数组；
#### 跳转课程海报页面
* 传递对应的课程的id
#### 跳转作业页面
* 传递对应的作业的数据
#### 上拉页面获取新数据
* **_二期_**
#### 渲染主页
* 轮播数据渲染轮播
* 作业广场数据渲染作业广场 

### 课程页面
#### 获取课程数据
* 获取课程表所有数据；
* 查询课程表所有数据；
#### 获取用户课程数据
* 获取用户表的课程数据；
* 查询用户表字段为 openid 值为全局存储的 _openid 的数据，得到唯一的查询结果的course数据；
#### 重构页面课程数据
* 把课程数据分为已报名未完结课程数据和未报名课程数据以及已完结课程；
* 通过用户course数据的键名判断是否报名；
* 通过用户course数据的create_date与当前日期以及课程数据的日期判断是否已完结；
* 把已报名的课程添加用户对应的course数据对象的course_schedule、create_date键值对，把已报名的课程的course_sectiont数组的所有对象添用户对应的course数据对象的course_section的对应的所有键值对；
#### 跳转课程详情页面
* 传递对应课程数据；
#### 跳转课程海报页面
* 传递对应的课程的id；
#### 渲染课程页面
* 已报名未完结课程数据渲染已报名课程列表；
* 未报名课程数据渲染未报名数据；
* 通过判断课程create_date和课程courese_duration，得到课程日期；
* 通过判断课程course_section的length和course_schedule,得到课程待完成数据；

### 已完结课程页面


### 课程详情页面
#### 获取传递的数据
* 获取课程数据
#### 跳转课程学习页面
* 传递讲师数据
* 传递课程时间
* 传递对应course_section数据
#### 渲染课程详情页面
* 渲染课程数据
* 通过判断课程create_date和课程courese_duration，得到课程日期；
* 通过判断课程course_section对应子课程的video_schedule和video.length，得到作业学习完成状态；
* 通过判断课程course_section的homework_id是否为null，得到作业提交状态；

### 课程海报页面

#### 获取传递的数据
* 获取传递的课程id
#### 查询课程数据
* 查询课程表中id字段为id的课程；
* 查询用户表中openid为全局openid的用户，获取用户course键为id的数据；
#### 初始化报名表单组件
* 包括组件函数功能函数和内容
#### 初始化报名表单提示组件
* 包括组件函数功能函数和内容
#### 获取验证码
* 调用接口发送请求；
#### 获取用户手机号
* 判断全局用户信息中tel是否为空；
* 空则获取手机号权限，且在数据库中存下；
* 非空则得到用户手机号；
#### 实现手机号输入框双向绑定和判断合法性
* 双向绑定;
* 正则判断;
#### 实现验证码按钮时间限制
* 获取验证码后设置定时器；
* 是否可用由手机号合法与定时器状态决定；
#### 报名课程以及用户课程初始化数据
* 验证码通过则插入课程id到用户信息course中
```JavaScript
      [COURSE_ID]: {
      course_schedule: [Number] // 课程进度，初始化为 0
      create_date: [DATE] // 课程创建日期
      course_section: // 子课程对象数组,子课程数目决定数组长度
        [
          {
            homework_id: [String ||| null] // 作业 ID，初始化为 null
            video_schedule: [Number] // 视频进度，初始化为 0
          },
          ...
        ]
```
#### 渲染课程海报页面
* 渲染课程数据海报；
* 渲染表单组件和提示组件；

### 课程学习页面

#### 获取传递的数据
#### 跳转作业页面
#### 获取作业数据
#### 渲染课程学习页面
#### 实现视频播放等事件

### 作业页面

#### 获取传递的数据
#### 上传作业
#### 修改作业
#### 点赞
#### 播放教师点评
#### 渲染作业页面

### 我的页面

#### 实现获取用户信息的权限
#### 判断用户信息是否存在
#### 修改用户信息
#### 跳转我的作品集
#### 渲染我的页面

### 我的作品集页面

#### 获取用户作品集数据
#### 渲染我的作品集页面
#### 跳转作业页面

