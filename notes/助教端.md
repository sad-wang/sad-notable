---
deleted: true
tags: [HappyWriting]
title: 助教端
created: '2020-06-19T04:13:33.412Z'
modified: '2020-06-20T03:06:43.951Z'
---

# 助教端
## 目前存在的问题
1. 登录与路由的架构问题
目前是没有做登录页面，我在根页面的默认路由里使用 http 请求的方式访问云函数，获得云开发的鉴权 key，拿到这个 key 就可以访问其他云函数和云存储文件。
目前是个助教端是 SPA，登录页面处于什么位置比较合适，是单独一个页面还是嵌入路由里面。
2. review 页面太庞大，如何优化的建议
对于录制的函数、播放的函数、获取云端文件等重复性操作我已经进行了封装调用，但目前的代码量还是很庞大..
## 目前实现的功能
1. 登录
目前简单通过 http 请求的方式访问云函数，云函数查询 opertaor 数据库，成功则响应云开发的鉴权 key，实现登录；
通过鉴权 key 即可访问其他云函数；
2. Task 列表
* 鉴权后通过 opertaor_id 请求 getTaskList 接口，响应得到 submitted、reviewed 两个任务数组并渲染到页面中；
* 通过顶部 Tab 标签进行列表切换；
* 通过点击 submitted 列表的批改或 reviewed 列表的查看实现跳转 review 路由，并传递点击 item 的 task_id 参数;
* 通过切换 reviewed 列表的 switch 按钮调用 recommendTask 接口，实现任务上墙；
3. 批改界面
* 通过路由传递的 task_id 请求 getTaskDetail 接口，响应得到  task 数据，并将可以直接渲染的数据渲染到页面中；
* 录音临时文件的获取
  task 数据中，每个步骤的录音存储的格式为云开发存储库的 FileID，需要在请求 getTaskDetail 接口后进行二次处理获取录音的临时文件 URL；
* 作业图片临时文件的获取
  同上
* 录制功能
  * 判断当前是否在播放或者有其他的步骤在录制，是则提示 '请先结束当前录制或播放', 否则开始录制
  * 开始录制
    * 设置 Store 中录制状态不可用，设置 Store 中当前录制的步骤为当前步骤；
    * 初始化录制数据为 null，初始化画板，初始化评教工具状态；
  * 录制
    * 绘制数据存储到临时 strokeData 中，录音存储的到临时 blobData 中，奖励数据存储到临时RewardData 中，绘制的椭圆存储到临时 circleData 中，绘制的矩形存储到临时 rectangleData 数据中；
  * 录制结束
    * 录音结束
    * 设置 Store 中录制状态可用，设置 Store 中当前录制的步骤为空；
    * 对应的录制数据存储到对应步骤的 data 中；
    * 临时数据初始化为 null，processStack 为空数组；
* 撤回功能
  * 在每此录制结束初始化录制步骤栈；
  * 录制过程每 stroke、selectCircle、selectRectangle、reward 都对应把类型入栈；
  * 撤回是录制步骤栈 pop，对应数据也 pop，并重新渲染对应数据数组，
* 上墙
  *  通过切换 reviewed 列表的 switch 按钮调用 recommendTask 接口，实现任务上墙；
* 保存和完成批改
  * 录制的音频是 Blob 格式，使用 new File() 创建对应文件对象，并使用云开发 SDK 上传到云存储库中，返回对应 FileID；
  * 调用 commitReview 接口实现上传批改数据；



